(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[180],{4481:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return Chat}});var a=s(67294),n=s(46011),r=s(90835),i=s(43988),l=s(38810),o=s(85893),Common_ChatComponent=function({bookingId:e,userId:t,userName:s="Voc\xea"}){let[n,r]=(0,a.useState)([]),[d,c]=(0,a.useState)(""),[m,x]=(0,a.useState)(!0),[u,h]=(0,a.useState)(!1),[g,f]=(0,a.useState)("online"),b=(0,a.useRef)(null),{addToast:p}=(0,i.p)(),scrollToBottom=()=>{b.current?.scrollIntoView({behavior:"smooth"})};(0,a.useEffect)(()=>{scrollToBottom()},[n]),(0,a.useEffect)(()=>{let fetchMessages=async()=>{try{let t=await (0,l.k_)(`/api/chat/${e}`,{method:"GET"});r(t.messages||decodedFunction()),x(!1),simulateWebSocket()}catch(e){r(decodedFunction()),x(!1),simulateWebSocket()}};fetchMessages()},[e]);let simulateWebSocket=()=>{f("online")},handleSendMessage=async t=>{if(t.preventDefault(),!d.trim()){p("Mensagem vazia","warning");return}h(!0);try{let t=await (0,l.k_)(`/api/chat/${e}/send`,{method:"POST",body:JSON.stringify({message:d})}),a={id:t.id||Date.now(),sender:"client",senderName:s,message:d,timestamp:new Date,status:"enviado"};r([...n,a]),c(""),p("Mensagem enviada","success"),h(!1)}catch(e){p("Erro ao enviar mensagem","error"),h(!1)}},handleRemoveMessage=e=>{r(n.filter(t=>t.id!==e)),p("Mensagem removida","info")},formatTime=e=>new Date(e).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}),formatDate=e=>{let t=new Date,s=new Date(t);s.setDate(s.getDate()-1);let a=new Date(e);return a.toDateString()===t.toDateString()?"Hoje":a.toDateString()===s.toDateString()?"Ontem":a.toLocaleDateString("pt-BR")};return m?(0,o.jsx)("div",{className:"p-6 text-center",children:"⏳ Carregando chat..."}):(0,o.jsxs)("div",{className:"flex flex-col h-screen bg-white rounded-lg shadow-lg overflow-hidden max-h-96",children:[(0,o.jsx)("div",{className:"p-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white",children:(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{className:"flex items-center gap-3",children:[(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl",children:"\uD83D\uDCAC"}),(0,o.jsx)("div",{className:`absolute bottom-0 right-0 w-3 h-3 rounded-full ${"online"===g?"bg-green-400":"bg-gray-400"}`})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"font-semibold",children:"Chat - Agendamento"}),(0,o.jsx)("p",{className:"text-xs text-blue-100",children:"online"===g?"\uD83D\uDFE2 Online":"⚪ Offline"})]})]}),(0,o.jsx)("button",{className:"text-white hover:bg-white/20 p-2 rounded transition",children:"⋮"})]})}),(0,o.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50",children:[n.map((e,t)=>{let s=0===t||formatDate(n[t-1].timestamp)!==formatDate(e.timestamp);return(0,o.jsxs)("div",{children:[s&&(0,o.jsxs)("div",{className:"flex items-center gap-2 my-4",children:[(0,o.jsx)("div",{className:"flex-1 border-t border-gray-300"}),(0,o.jsx)("span",{className:"text-xs text-gray-500 px-2",children:formatDate(e.timestamp)}),(0,o.jsx)("div",{className:"flex-1 border-t border-gray-300"})]}),(0,o.jsxs)("div",{className:`flex gap-2 ${"client"===e.sender?"flex-row-reverse":""}`,children:[(0,o.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-white text-sm font-bold",children:e.senderName.charAt(0)}),(0,o.jsxs)("div",{className:`max-w-xs lg:max-w-md ${"client"===e.sender?"items-end":"items-start"} flex flex-col`,children:[(0,o.jsx)("p",{className:`text-xs font-semibold ${"client"===e.sender?"text-right":""}`,children:e.senderName}),(0,o.jsxs)("div",{className:`mt-1 p-3 rounded-lg text-sm ${"client"===e.sender?"bg-blue-600 text-white rounded-br-none":"bg-white border border-gray-200 text-gray-900 rounded-bl-none"} hover:shadow-md transition group relative`,children:[(0,o.jsx)("p",{className:"break-words",children:e.message}),(0,o.jsx)("button",{onClick:()=>handleRemoveMessage(e.id),className:"absolute -top-6 right-0 text-xs opacity-0 group-hover:opacity-100 transition bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"✕"})]}),(0,o.jsxs)("p",{className:`text-xs text-gray-500 mt-1 ${"client"===e.sender?"text-right":""}`,children:[formatTime(e.timestamp)," ","lido"===e.status?"✓✓":"enviado"===e.status?"✓":"⏱"]})]})]})]},e.id)}),(0,o.jsx)("div",{ref:b})]}),(0,o.jsxs)("form",{onSubmit:handleSendMessage,className:"p-4 border-t border-gray-200 bg-white",children:[(0,o.jsxs)("div",{className:"flex gap-2",children:[(0,o.jsx)("button",{type:"button",className:"flex-shrink-0 px-3 py-2 text-xl bg-gray-100 hover:bg-gray-200 rounded transition",title:"Anexar arquivo",children:"\uD83D\uDCCE"}),(0,o.jsx)("input",{type:"text",value:d,onChange:e=>c(e.target.value),placeholder:"Digite sua mensagem...",disabled:u,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,o.jsx)("button",{type:"submit",disabled:u||!d.trim(),className:"flex-shrink-0 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:u?"⏳":"➤"})]}),(0,o.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["\uD83D\uDCA1 Use ",(0,o.jsx)("strong",{children:"Enter"})," para enviar, ",(0,o.jsx)("strong",{children:"Shift+Enter"})," para quebra de linha"]})]})]})};function Chat(){let[e]=(0,a.useState)("booking_001");return(0,o.jsxs)("div",{className:"flex flex-col min-h-screen",children:[(0,o.jsx)(n.Z,{}),(0,o.jsx)("main",{className:"flex-grow p-6 bg-gray-50",children:(0,o.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,o.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"\uD83D\uDCAC Chat do Agendamento"}),(0,o.jsx)(Common_ChatComponent,{bookingId:e,userId:"user_123",userName:"Maria Silva"})]})}),(0,o.jsx)(r.Z,{})]})}},52583:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat",function(){return s(4481)}])}},function(e){e.O(0,[837,774,336,216,888,179],function(){return e(e.s=52583)}),_N_E=e.O()}]);