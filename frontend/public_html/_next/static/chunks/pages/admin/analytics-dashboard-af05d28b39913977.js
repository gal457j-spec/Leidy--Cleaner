(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[385],{75692:function(e,a,s){"use strict";s.r(a),s.d(a,{__N_SSP:function(){return v},default:function(){return AdminAnalytics}});var t=s(67294),l=s(9008),r=s.n(l),d=s(11163),n=s(29557),i=s(98687),o=s(14195),c=s(3023),x=s(75358),h=s(99113),m=s(44469),u=s(79231),g=s(94831),p=s(61860),j=s(85893);let RevenueChart=({data:e})=>(0,j.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,j.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Revenue Trend"}),(0,j.jsx)(n.h,{width:"100%",height:300,children:(0,j.jsxs)(i.w,{data:e,children:[(0,j.jsx)(o.q,{strokeDasharray:"3 3"}),(0,j.jsx)(c.K,{dataKey:"date"}),(0,j.jsx)(x.B,{}),(0,j.jsx)(h.u,{formatter:e=>`R$ ${e.toLocaleString("pt-BR")}`}),(0,j.jsx)(m.D,{}),(0,j.jsx)(u.x1,{type:"monotone",dataKey:"revenue",stroke:"#3b82f6",strokeWidth:2,name:"Receita"}),(0,j.jsx)(u.x1,{type:"monotone",dataKey:"expenses",stroke:"#ef4444",strokeWidth:2,name:"Despesas"}),(0,j.jsx)(u.x1,{type:"monotone",dataKey:"profit",stroke:"#10b981",strokeWidth:2,name:"Lucro"})]})})]}),BookingTrendsChart=({data:e})=>(0,j.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,j.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Booking Trends"}),(0,j.jsx)(n.h,{width:"100%",height:300,children:(0,j.jsxs)(g.v,{data:e,children:[(0,j.jsx)(o.q,{strokeDasharray:"3 3"}),(0,j.jsx)(c.K,{dataKey:"date"}),(0,j.jsx)(x.B,{}),(0,j.jsx)(h.u,{}),(0,j.jsx)(m.D,{}),(0,j.jsx)(p.$Q,{dataKey:"bookings",fill:"#3b82f6",name:"Agendamentos"}),(0,j.jsx)(p.$Q,{dataKey:"completed",fill:"#10b981",name:"Completados"}),(0,j.jsx)(p.$Q,{dataKey:"cancelled",fill:"#ef4444",name:"Cancelados"})]})})]}),ChurnRiskHeatmap=({data:e})=>(0,j.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,j.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Churn Risk Analysis"}),(0,j.jsx)("div",{className:"overflow-x-auto",children:(0,j.jsxs)("table",{className:"w-full text-sm",children:[(0,j.jsx)("thead",{className:"bg-gray-100",children:(0,j.jsxs)("tr",{children:[(0,j.jsx)("th",{className:"p-2 text-left",children:"Metric"}),(0,j.jsx)("th",{className:"p-2 text-center",children:"Status"}),(0,j.jsx)("th",{className:"p-2 text-right",children:"Value"}),(0,j.jsx)("th",{className:"p-2 text-left",children:"Risk"})]})}),(0,j.jsx)("tbody",{children:e.map((e,a)=>{let s="bg-green-100",t="Baixo";return e.risk>70?(s="bg-red-100",t="Alto"):e.risk>40&&(s="bg-yellow-100",t="M\xe9dio"),(0,j.jsxs)("tr",{className:"border-t hover:bg-gray-50",children:[(0,j.jsx)("td",{className:"p-2",children:e.metric}),(0,j.jsx)("td",{className:"p-2 text-center",children:(0,j.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,j.jsx)("div",{className:`h-2 rounded-full ${e.risk>70?"bg-red-500":e.risk>40?"bg-yellow-500":"bg-green-500"}`,style:{width:`${e.risk}%`}})})}),(0,j.jsx)("td",{className:"p-2 text-right font-bold",children:e.value}),(0,j.jsx)("td",{className:`p-2 font-bold ${s}`,children:t})]},a)})})]})})]}),AnalyticsDashboard=({data:e,loading:a,error:s})=>{let[l,r]=(0,t.useState)("30days"),[d,n]=(0,t.useState)(["revenue","bookings","conversion"]);return a?(0,j.jsx)("div",{className:"p-8 text-center",children:"Carregando analytics..."}):s?(0,j.jsxs)("div",{className:"p-8 text-center text-red-600",children:["Erro ao carregar dados: ",s]}):(0,j.jsxs)("div",{className:"space-y-6",children:[(0,j.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:(0,j.jsxs)("div",{className:"flex justify-between items-center",children:[(0,j.jsx)("h2",{className:"text-2xl font-bold",children:"Analytics Dashboard"}),(0,j.jsxs)("select",{value:l,onChange:e=>r(e.target.value),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,j.jsx)("option",{value:"7days",children:"\xdaltimos 7 dias"}),(0,j.jsx)("option",{value:"30days",children:"\xdaltimos 30 dias"}),(0,j.jsx)("option",{value:"90days",children:"\xdaltimos 90 dias"}),(0,j.jsx)("option",{value:"1year",children:"\xdaltimo ano"}),(0,j.jsx)("option",{value:"custom",children:"Custom"})]})]})}),(0,j.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,j.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,j.jsx)("h4",{className:"text-gray-600 text-sm",children:"Total Revenue"}),(0,j.jsxs)("p",{className:"text-2xl font-bold text-blue-600",children:["R$ ",(e.totalRevenue||0).toLocaleString("pt-BR")]}),(0,j.jsxs)("p",{className:"text-xs text-gray-500",children:["↑ ",e.revenueGrowth||0,"% vs period anterior"]})]}),(0,j.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,j.jsx)("h4",{className:"text-gray-600 text-sm",children:"Total Bookings"}),(0,j.jsx)("p",{className:"text-2xl font-bold text-green-600",children:e.totalBookings||0}),(0,j.jsxs)("p",{className:"text-xs text-gray-500",children:["↑ ",e.bookingGrowth||0,"% vs period anterior"]})]}),(0,j.jsxs)("div",{className:"bg-purple-50 p-4 rounded-lg",children:[(0,j.jsx)("h4",{className:"text-gray-600 text-sm",children:"Active Users"}),(0,j.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:e.activeUsers||0}),(0,j.jsxs)("p",{className:"text-xs text-gray-500",children:["↑ ",e.userGrowth||0,"% vs period anterior"]})]}),(0,j.jsxs)("div",{className:"bg-orange-50 p-4 rounded-lg",children:[(0,j.jsx)("h4",{className:"text-gray-600 text-sm",children:"Conversion Rate"}),(0,j.jsxs)("p",{className:"text-2xl font-bold text-orange-600",children:[(e.conversionRate||0).toFixed(1),"%"]}),(0,j.jsxs)("p",{className:"text-xs text-gray-500",children:["↑ ",e.conversionGrowth||0,"% vs period anterior"]})]})]}),(0,j.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,j.jsx)(RevenueChart,{data:e.revenueData||[]}),(0,j.jsx)(BookingTrendsChart,{data:e.bookingData||[]})]}),(0,j.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,j.jsx)("decoded",{data:e.funnelData||{}}),(0,j.jsx)("decoded",{data:e.segmentationData||[]})]}),(0,j.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,j.jsx)("decoded",{data:e.clvData||[]}),(0,j.jsx)(ChurnRiskHeatmap,{data:e.churnData||[]})]}),(0,j.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,j.jsx)("h3",{className:"text-lg font-bold mb-4",children:"Customize Dashboard"}),(0,j.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:["revenue","bookings","conversion","ltv","churn","engagement","payments","reviews"].map(e=>(0,j.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,j.jsx)("input",{type:"checkbox",defaultChecked:d.includes(e),onChange:a=>{a.target.checked?n([...d,e]):n(d.filter(a=>a!==e))},className:"w-4 h-4"}),(0,j.jsx)("span",{className:"text-sm capitalize",children:e})]},e))})]})]})};var b=s(87066);let y="https://cleanerleidy.com.br/api/api";var hooks_useAnalytics=(e="30days")=>{let[a,l]=(0,t.useState)(null),[r,d]=(0,t.useState)(!0),[n,i]=(0,t.useState)(null),o=(0,t.useCallback)(async()=>{try{d(!0),i(null);let{getAuthHeader:a}=await Promise.resolve().then(s.bind(s,56441)),t={headers:{...a()}},r=await b.Z.get(`${y}/analytics/dashboard?dateRange=${e}`,t);l(r.data.data)}catch(e){i(e.response?.data?.error||"Failed to fetch analytics")}finally{d(!1)}},[e]);(0,t.useEffect)(()=>{o()},[o]);let c=(0,t.useCallback)(async(e={})=>{try{let{getAuthHeader:a}=await Promise.resolve().then(s.bind(s,56441)),t={headers:{...a()}},l=await b.Z.get(`${y}/analytics/revenue`,{...t,params:e});return l.data.data}catch(e){throw e}},[]);(0,t.useCallback)(async(e={})=>{try{let{getAuthHeader:a}=await Promise.resolve().then(s.bind(s,56441)),t={headers:{...a()}},l=await b.Z.get(`${y}/analytics/conversion`,{...t,params:e});return l.data.data}catch(e){throw e}},[]),(0,t.useCallback)(async(e={})=>{try{let{getAuthHeader:a}=await Promise.resolve().then(s.bind(s,56441)),t={headers:{...a()}},l=await b.Z.get(`${y}/analytics/customers`,{...t,params:e});return l.data.data}catch(e){throw e}},[]);let x=(0,t.useCallback)(async(e={})=>{try{let{getAuthHeader:a}=await Promise.resolve().then(s.bind(s,56441)),t={headers:{...a()}},l=await b.Z.get(`${y}/analytics/churn`,{...t,params:e});return l.data.data}catch(e){throw e}},[]),h=(0,t.useCallback)(async(e={})=>{try{let a=localStorage.getItem("token"),s={headers:{Authorization:`Bearer ${a}`}},t=await b.Z.get(`${y}/analytics/bookings`,{...s,params:e});return t.data.data}catch(e){throw e}},[]),m=(0,t.useCallback)(async(a="pdf",t={})=>{try{let{getAuthHeader:l}=await Promise.resolve().then(s.bind(s,56441)),r={headers:{...l()},responseType:"blob"},d=await b.Z.post(`${y}/analytics/export`,{format:a,dateRange:e,...t},r),n=window.URL.createObjectURL(new Blob([d.data])),i=document.createElement("a");i.href=n,i.setAttribute("download",`analytics-${new Date().toISOString().split("T")[0]}.${a}`),document.body.appendChild(i),i.click(),i.parentElement.removeChild(i)}catch(e){throw e}},[e]);return{data:a,loading:r,error:n,refetch:o,fetchRevenueStats:c,decoded,decoded,fetchChurnAnalytics:x,fetchBookingStats:h,exportReport:m}},v=!0;function AdminAnalytics(){let e=(0,d.useRouter)(),[a,s]=(0,t.useState)("30days"),[l,n]=(0,t.useState)("pdf"),[i,o]=(0,t.useState)(!1),{data:c,loading:x,error:h,refetch:m,exportReport:u}=hooks_useAnalytics(a);(0,t.useEffect)(()=>{s(e.query.range||"30days")},[e.query.range]);let handleExport=async()=>{try{o(!0),await u(l,{dateRange:a})}catch(e){alert("Falha ao exporting relat\xf3rio")}finally{o(!1)}},handleDateRangeChange=a=>{s(a),e.push(`/admin/analytics?range=${a}`,void 0,{shallow:!0})};return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(r(),{children:[(0,j.jsx)("title",{children:"Admin Analytics Dashboard - Avante"}),(0,j.jsx)("meta",{name:"description",content:"Platform analytics and reporting dashboard"})]}),(0,j.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,j.jsx)("div",{className:"bg-white shadow-md",children:(0,j.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:(0,j.jsxs)("div",{className:"flex justify-between items-center",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Analytics Dashboard"}),(0,j.jsx)("p",{className:"text-gray-600 mt-1",children:"Comprehensive platform metrics and insights"})]}),(0,j.jsx)("button",{onClick:()=>{m()},disabled:x,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:x?"Carregando...":"Atualizar"})]})})}),(0,j.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[h&&(0,j.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6",children:["Erro ao carregar analytics: ",h]}),(0,j.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:(0,j.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date Range"}),(0,j.jsxs)("select",{value:a,onChange:e=>handleDateRangeChange(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,j.jsx)("option",{value:"7days",children:"\xdaltimos 7 dias"}),(0,j.jsx)("option",{value:"30days",children:"\xdaltimos 30 dias"}),(0,j.jsx)("option",{value:"90days",children:"\xdaltimos 90 dias"}),(0,j.jsx)("option",{value:"1year",children:"\xdaltimo ano"})]})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Export Format"}),(0,j.jsxs)("select",{value:l,onChange:e=>n(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,j.jsx)("option",{value:"pdf",children:"PDF"}),(0,j.jsx)("option",{value:"csv",children:"CSV"}),(0,j.jsx)("option",{value:"xlsx",children:"Excel (XLSX)"}),(0,j.jsx)("option",{value:"json",children:"JSON"})]})]}),(0,j.jsx)("div",{className:"flex items-end",children:(0,j.jsx)("button",{onClick:handleExport,disabled:i||x,className:"w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 font-medium",children:i?"Exportando...":`Export ${l.toUpperCase()}`})})]})}),(0,j.jsx)(AnalyticsDashboard,{data:c,loading:x,error:h})]})]}),(0,j.jsx)("style",{jsx:!0,children:`
        @media (max-width: 768px) {
          .grid {
            grid-template-columns: 1fr;
          }
        }
      `})]})}},81209:function(e,a,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/analytics-dashboard",function(){return s(75692)}])}},function(e){e.O(0,[216,774,336,888,179],function(){return e(e.s=81209)}),_N_E=e.O()}]);