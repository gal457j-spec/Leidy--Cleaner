(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[222],{90419:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return CheckoutPage}});var r=t(67294),s=t(11163),d=t(46011),l=t(90835),o=t(9008),n=t.n(o),i=t(85893);function PixQRCodeCheckout({bookingId:e,amount:a,orderId:t}){let[s,d]=(0,r.useState)(null),[l,o]=(0,r.useState)(!0),[c,x]=(0,r.useState)(null),[m,g]=(0,r.useState)("waiting"),[h,b]=(0,r.useState)(600),[u,p]=(0,r.useState)(!1),[y,j]=(0,r.useState)(!0);(0,r.useEffect)(()=>{fetchPaymentData()},[e]),(0,r.useEffect)(()=>{if(!y||"confirmed"===m)return;let e=setInterval(()=>{b(e=>e<=1?(g("expired"),j(!1),0):e-1)},1e3);return()=>clearInterval(e)},[y,m]),(0,r.useEffect)(()=>{if(!y||!s?.transactionId)return;let checkStatus=async()=>{try{let e=localStorage.getItem("token"),a=await fetch(`/api/pix/status/${s.transactionId}`,{headers:{Authorization:`Bearer ${e}`}});if(!a.ok)return;let t=await a.json();t.data?.status==="confirmed"?(g("confirmed"),j(!1)):t.data?.status==="received"&&g("received")}catch(e){console.error("Erro ao verificar status:",e)}},e=setInterval(checkStatus,5e3);return()=>clearInterval(e)},[y,s?.transactionId]);let fetchPaymentData=async()=>{try{o(!0);let r=localStorage.getItem("token"),s=await fetch("/api/pix/create",{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({bookingId:e,amount:a,orderId:t})});if(!s.ok)throw Error(`Erro ${s.status}: ${s.statusText}`);let l=await s.json();if(l.success&&l.data)d(l.data),x(null);else throw Error(l.error||"Erro ao gerar QR Code")}catch(e){console.error("Erro ao buscar dados de pagamento:",e),x(e.message),j(!1)}finally{o(!1)}},copyToClipboard=async()=>{try{let e=s?.brCode||s?.qrCode;e&&(await navigator.clipboard.writeText(e),p(!0),setTimeout(()=>p(!1),2e3))}catch(e){console.error("Erro ao copiar:",e)}};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n(),{children:[(0,i.jsx)("title",{children:"Checkout PIX - Leidy Cleaner"}),(0,i.jsx)("meta",{name:"description",content:"Finalize seu pagamento com PIX"})]}),(0,i.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-green-50 to-gray-50 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4",children:(0,i.jsxs)("div",{className:"w-full max-w-md",children:[l&&(0,i.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 text-center",children:[(0,i.jsx)("div",{className:"inline-block",children:(0,i.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})}),(0,i.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mt-4",children:"Gerando QR Code..."})]}),c&&!l&&(0,i.jsxs)("div",{className:"bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 rounded-lg shadow-xl p-6",children:[(0,i.jsx)("h3",{className:"text-red-800 dark:text-red-100 font-bold mb-2",children:"Erro ao Gerar QR Code"}),(0,i.jsx)("p",{className:"text-red-700 dark:text-red-200 text-sm mb-4",children:c}),(0,i.jsx)("button",{onClick:fetchPaymentData,className:"w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded transition",children:"Tentar Novamente"})]}),!l&&!c&&s&&(0,i.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden",children:[(0,i.jsxs)("div",{className:"bg-gradient-to-r from-green-600 to-green-700 text-white p-6 text-center",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"Pagamento com PIX"}),(0,i.jsx)("p",{className:"text-green-100",children:"Escaneie o c\xf3digo abaixo"})]}),(0,i.jsxs)("div",{className:"p-8",children:[(0,i.jsxs)("div",{className:"text-center mb-8",children:[(0,i.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-sm mb-2",children:"Valor a Pagar"}),(0,i.jsxs)("p",{className:"text-4xl font-bold text-green-700 dark:text-green-400",children:["R$ ",a?.toLocaleString("pt-BR",{decoded:2})]})]}),(0,i.jsxs)("div",{className:`relative bg-white dark:bg-gray-700 rounded-lg p-4 mb-6 ${"expired"===m?"opacity-50":""}`,children:[s?.qrCodeImage?(0,i.jsx)("div",{className:"text-center",children:(0,i.jsx)("img",{src:s.qrCodeImage,alt:"PIX QR Code",className:"w-full max-w-xs mx-auto"})}):(0,i.jsx)("div",{className:"w-full aspect-square bg-gray-200 dark:bg-gray-600 rounded flex items-center justify-center",children:(0,i.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"QR Code indispon\xedvel"})}),"expired"===m&&(0,i.jsx)("div",{className:"absolute inset-0 bg-red-500 bg-opacity-20 rounded flex items-center justify-center",children:(0,i.jsx)("div",{className:"text-center",children:(0,i.jsx)("p",{className:"text-red-700 dark:text-red-300 font-bold text-lg",children:"EXPIRADO"})})})]}),(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"Ou copie o c\xf3digo PIX:"}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)("input",{type:"text",value:s?.brCode||"",readOnly:!0,className:"flex-1 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 px-4 py-2 rounded text-sm font-mono border border-gray-300 dark:border-gray-600 focus:border-green-500"}),(0,i.jsx)("button",{onClick:copyToClipboard,className:`px-4 py-2 rounded font-semibold transition ${u?"bg-green-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:u?"✓ Copiado":"Copiar"})]})]}),(0,i.jsxs)("div",{className:`text-center py-4 px-4 rounded-lg bg-gray-50 dark:bg-gray-700 mb-6 ${(()=>{switch(m){case"confirmed":return"text-green-600 dark:text-green-400";case"received":return"text-blue-600 dark:text-blue-400";case"waiting":return"text-yellow-600 dark:text-yellow-400";case"expired":return"text-red-600 dark:text-red-400";default:return"text-gray-600 dark:text-gray-400"}})()}`,children:[(0,i.jsx)("p",{className:"font-semibold text-lg mb-2",children:(()=>{switch(m){case"confirmed":return"✅ Pagamento Confirmado!";case"received":return"✓ Pagamento Recebido";case"waiting":return"⏳ Aguardando Pagamento";case"expired":return"❌ QR Code Expirado";default:return"Carregando..."}})()}),"expired"!==m&&"confirmed"!==m&&(0,i.jsxs)("p",{className:"text-sm",children:["Expira em: ",(0,i.jsx)("span",{className:"font-mono font-bold",children:`${Math.floor(h/60)}:${(h%60).toString().padStart(2,"0")}`})]})]}),(0,i.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900 border border-blue-200 dark:border-blue-700 rounded-lg p-4 mb-6",children:[(0,i.jsx)("h4",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"\uD83D\uDCF1 Como Pagar:"}),(0,i.jsxs)("ol",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1",children:[(0,i.jsx)("li",{children:"1. Abra seu app de banco"}),(0,i.jsx)("li",{children:"2. Selecione PIX → QR Code"}),(0,i.jsx)("li",{children:"3. Escaneie a imagem acima"}),(0,i.jsx)("li",{children:"4. Confirme o valor e envie"})]})]}),"confirmed"===m?(0,i.jsx)("button",{onClick:()=>{localStorage.removeItem("pendingBooking"),window.location.href="/confirmacao"},className:"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition text-lg",children:"✓ Ir para Confirma\xe7\xe3o"}):"expired"===m?(0,i.jsx)("button",{onClick:fetchPaymentData,className:"w-full bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-3 px-4 rounded-lg transition",children:"Gerar Novo QR Code"}):(0,i.jsx)("button",{disabled:!0,className:"w-full bg-gray-300 dark:bg-gray-600 text-gray-600 dark:text-gray-400 font-bold py-3 px-4 rounded-lg cursor-not-allowed",children:"⏳ Aguardando Confirma\xe7\xe3o..."}),(0,i.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center mt-6",children:["ID da Transa\xe7\xe3o: ",(0,i.jsx)("span",{className:"font-mono",children:s?.transactionId})]})]}),(0,i.jsx)("div",{className:"bg-gray-50 dark:bg-gray-700 px-8 py-4 border-t border-gray-200 dark:border-gray-600",children:(0,i.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 text-center",children:"\uD83D\uDCA1 D\xfavida? Entre em contato com nosso suporte"})})]})]})})]})}var c=t(43988),x=t(38810),Payments_CheckoutForm=function({amount:e=120}){let[a,t]=(0,r.useState)("pix"),[s,d]=(0,r.useState)(!1),{addToast:l}=(0,c.p)(),handlePay=async()=>{d(!0);try{let t=await (0,x.k_)("/api/payments/create",{method:"POST",body:JSON.stringify({amount:e,method:a})});l("Pagamento realizado (mock). ID: "+(t.id||"MOCK"),"success")}catch(e){l(e.message||"Erro ao processar pagamento","error")}finally{d(!1)}};return(0,i.jsxs)("div",{className:"p-4 bg-white rounded shadow",children:[(0,i.jsx)("h3",{className:"text-lg font-bold mb-3",children:"Pagamento"}),(0,i.jsxs)("p",{className:"mb-4",children:["Valor: ",(0,i.jsxs)("strong",{children:["R$ ",e.toFixed(2)]})]}),(0,i.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,i.jsxs)("label",{className:`block p-3 border rounded ${"pix"===a?"border-blue-500 bg-blue-50":""}`,children:[(0,i.jsx)("input",{type:"radio",name:"method",checked:"pix"===a,onChange:()=>t("pix")})," ",(0,i.jsx)("span",{className:"ml-2 font-semibold",children:"PIX (QR)"})]}),(0,i.jsxs)("label",{className:`block p-3 border rounded ${"card"===a?"border-blue-500 bg-blue-50":""}`,children:[(0,i.jsx)("input",{type:"radio",name:"method",checked:"card"===a,onChange:()=>t("card")})," ",(0,i.jsx)("span",{className:"ml-2 font-semibold",children:"Cart\xe3o de Cr\xe9dito"})]}),(0,i.jsxs)("label",{className:`block p-3 border rounded ${"boleto"===a?"border-blue-500 bg-blue-50":""}`,children:[(0,i.jsx)("input",{type:"radio",name:"method",checked:"boleto"===a,onChange:()=>t("boleto")})," ",(0,i.jsx)("span",{className:"ml-2 font-semibold",children:"Boleto"})]})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)("button",{onClick:handlePay,disabled:s,className:"px-4 py-2 bg-green-600 text-white rounded",children:s?"Processando...":"Pagar"}),(0,i.jsx)("button",{onClick:()=>l("Pagamento cancelado","info"),className:"px-4 py-2 bg-gray-200 rounded",children:"Cancelar"})]})]})},Loyalty_LoyaltyPanel=function(){let[e,a]=(0,r.useState)(0);(0,r.useEffect)(()=>{let e=parseInt(localStorage.getItem("loyalty_points")||"0",10);a(e)},[]);let earn=t=>{let r=e+t;localStorage.setItem("loyalty_points",r),a(r)},redeem=t=>{if(e<t)return alert("Pontos insuficientes");let r=e-t;localStorage.setItem("loyalty_points",r),a(r),alert("Cupom aplicado: R$ "+(t/10).toFixed(2))};return(0,i.jsxs)("div",{className:"p-4 bg-white rounded shadow",children:[(0,i.jsx)("h3",{className:"text-lg font-bold mb-2",children:"Programa de Fidelidade"}),(0,i.jsxs)("p",{className:"mb-2",children:["Pontos acumulados: ",(0,i.jsx)("strong",{children:e})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)("button",{onClick:()=>earn(10),className:"px-3 py-2 bg-blue-600 text-white rounded",children:"Ganhar 10 pts"}),(0,i.jsx)("button",{onClick:()=>redeem(50),className:"px-3 py-2 bg-green-600 text-white rounded",children:"Resgatar 50 pts"})]}),(0,i.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"1 ponto = R$0.10 (exemplo)"})]})},m=t(5152),g=t.n(m);let h=g()(()=>t.e(139).then(t.bind(t,80139)),{ssr:!1});function CheckoutPage(){let e=(0,s.useRouter)(),{booking_id:a,amount:t,method:o="pix"}=e.query,[c,x]=(0,r.useState)("pix"),[m,g]=(0,r.useState)(null),[b,u]=(0,r.useState)(!!a);(0,r.useEffect)(()=>{a&&"undefined"!==a?fetchBookingData():u(!1)},[a]),(0,r.useEffect)(()=>{o&&"undefined"!==o&&x(o)},[o]);let fetchBookingData=async()=>{try{let e=localStorage.getItem("token"),t=await fetch(`/api/bookings/${a}`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(t.ok){let e=await t.json();e.success&&e.data&&g(e.data)}}catch(e){console.error("Erro ao buscar booking:",e)}finally{u(!1)}},p=m?.total_price||(t?parseFloat(t):120);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n(),{children:[(0,i.jsx)("title",{children:"Checkout - Leidy Cleaner"}),(0,i.jsx)("meta",{name:"description",content:"Finalize seu agendamento com seguran\xe7a"})]}),(0,i.jsxs)("div",{className:"flex flex-col min-h-screen bg-gray-50 dark:bg-gray-900",children:[(0,i.jsx)(d.Z,{}),(0,i.jsxs)("main",{className:"flex-grow max-w-6xl mx-auto w-full px-4 py-6 space-y-6",children:[(0,i.jsxs)("div",{className:"mb-8",children:[(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Checkout Seguro"}),(0,i.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"Escolha o m\xe9todo de pagamento e finalize seu agendamento"})]}),b?(0,i.jsx)("div",{className:"flex justify-center items-center py-12",children:(0,i.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})}):(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,i.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,i.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[(0,i.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:"M\xe9todo de Pagamento"}),(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("label",{className:`flex items-center p-4 border-2 rounded-lg cursor-pointer transition ${"pix"===c?"border-green-600 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 hover:border-green-600"}`,children:[(0,i.jsx)("input",{type:"radio",name:"payment-method",value:"pix",checked:"pix"===c,onChange:e=>x(e.target.value),className:"w-5 h-5"}),(0,i.jsxs)("span",{className:"ml-4",children:[(0,i.jsx)("span",{className:"block font-bold text-gray-900 dark:text-white",children:"\uD83D\uDC9A PIX (QR Code)"}),(0,i.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Instant\xe2neo - Escanear c\xf3digo QR com seu banco"})]})]}),(0,i.jsxs)("label",{className:`flex items-center p-4 border-2 rounded-lg cursor-pointer transition ${"card"===c?"border-blue-600 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-blue-600"}`,children:[(0,i.jsx)("input",{type:"radio",name:"payment-method",value:"card",checked:"card"===c,onChange:e=>x(e.target.value),className:"w-5 h-5"}),(0,i.jsxs)("span",{className:"ml-4",children:[(0,i.jsx)("span",{className:"block font-bold text-gray-900 dark:text-white",children:"\uD83D\uDCB3 Cart\xe3o de Cr\xe9dito"}),(0,i.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Parcelado em at\xe9 12x sem juros"})]})]}),(0,i.jsxs)("label",{className:`flex items-center p-4 border-2 rounded-lg cursor-pointer transition ${"boleto"===c?"border-yellow-600 bg-yellow-50 dark:bg-yellow-900/20":"border-gray-200 dark:border-gray-700 hover:border-yellow-600"}`,children:[(0,i.jsx)("input",{type:"radio",name:"payment-method",value:"boleto",checked:"boleto"===c,onChange:e=>x(e.target.value),className:"w-5 h-5"}),(0,i.jsxs)("span",{className:"ml-4",children:[(0,i.jsx)("span",{className:"block font-bold text-gray-900 dark:text-white",children:"\uD83D\uDCC4 Boleto Banc\xe1rio"}),(0,i.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Vencimento em 3 dias \xfateis"})]})]})]})]}),"pix"===c&&(0,i.jsx)(PixQRCodeCheckout,{bookingId:a,amount:p,orderId:`ORDER-${Date.now()}`}),"pix"!==c&&(0,i.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:(0,i.jsx)(Payments_CheckoutForm,{amount:p,method:c})})]}),(0,i.jsxs)("div",{className:"lg:col-span-1 space-y-6",children:[m&&(0,i.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[(0,i.jsx)("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"Resumo do Pedido"}),(0,i.jsxs)("div",{className:"space-y-3 text-sm mb-4 pb-4 border-b border-gray-200 dark:border-gray-700",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Servi\xe7o"}),(0,i.jsx)("p",{className:"font-semibold text-gray-900 dark:text-white",children:m.service_type||"Limpeza"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Data"}),(0,i.jsx)("p",{className:"font-semibold text-gray-900 dark:text-white",children:m.scheduled_date?new Date(m.scheduled_date).toLocaleDateString("pt-BR"):"N/A"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Dura\xe7\xe3o"}),(0,i.jsxs)("p",{className:"font-semibold text-gray-900 dark:text-white",children:[m.duration_hours||2,"h"]})]})]}),(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)("span",{className:"font-bold text-gray-900 dark:text-white",children:"Total:"}),(0,i.jsxs)("span",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:["R$ ",p.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]})]}),!m&&(0,i.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[(0,i.jsx)("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"Valor do Pagamento"}),(0,i.jsxs)("div",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:["R$ ",p.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]}),m&&(0,i.jsx)(Loyalty_LoyaltyPanel,{}),(0,i.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg p-4",children:[(0,i.jsx)("h4",{className:"font-semibold text-blue-900 dark:text-blue-300 mb-2",children:"\uD83D\uDCAC Precisa de Ajuda?"}),(0,i.jsx)("p",{className:"text-sm text-blue-800 dark:text-blue-400 mb-3",children:"Fale com nosso suporte no WhatsApp"}),(0,i.jsx)("a",{href:"https://wa.me/5551980303740",target:"_blank",rel:"noopener noreferrer",className:"inline-block w-full text-center px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition font-semibold",children:"Abrir Chat"})]})]})]})]}),(0,i.jsx)("div",{className:"mt-4",children:(0,i.jsx)(h,{})}),(0,i.jsx)(l.Z,{})]})]})}},95338:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/checkout",function(){return t(90419)}])}},function(e){e.O(0,[216,837,774,336,888,179],function(){return e(e.s=95338)}),_N_E=e.O()}]);